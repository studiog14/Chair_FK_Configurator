<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Chair FK Configurator</title>
<style>
  body { margin: 0; overflow: hidden; }
  #log {
    position: fixed;
    top: 5px;
    left: 5px;
    color: #333;
    background: rgba(255,255,255,0.8);
    padding: 5px 10px;
    font-family: monospace;
    z-index: 10;
    max-width: 300px;
    white-space: pre-wrap;
    font-size: 13px;
  }
</style>

<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.module.js",
    "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.152.2/examples/jsm/"
  }
}
</script>
</head>
<body>
<div id="log">Log:</div>

<script type="module">
import * as THREE from 'three';
import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

const logElem = document.getElementById('log');
function log(msg) {
  console.log(msg);
  logElem.textContent += '\n' + msg;
}

const scene = new THREE.Scene();
scene.background = new THREE.Color(0xd0d0d0);

const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0, 1.8, 3);

const renderer = new THREE.WebGLRenderer({antialias: true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
scene.add(ambientLight);

const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
directionalLight.position.set(5, 10, 7);
directionalLight.castShadow = true;
scene.add(directionalLight);

const floorGeometry = new THREE.PlaneGeometry(10, 10);
const floorMaterial = new THREE.MeshStandardMaterial({color: 0xaaaaaa, roughness: 0.8, metalness: 0.2});
const floor = new THREE.Mesh(floorGeometry, floorMaterial);
floor.rotation.x = - Math.PI / 2;
floor.position.y = 0;
floor.receiveShadow = true;
scene.add(floor);

const loader = new GLTFLoader();

const SHEET_URL = "https://opensheet.elk.sh/1vCs6YeHgKqlYwg8rvJOqVzNRnXeATJCBuK-zh3NNj78/Dane";

fetch(SHEET_URL)
  .then(res => res.json())
  .then(data => {
    console.log('Odpowiedź z arkusza:', data);
    if(!data || data.length === 0) {
      log("Brak danych z arkusza!");
      return;
    }

    if (typeof data[0] === 'object' && data[0] !== null && 'Nazwa' in data[0]) {
      const firstModelName = data[0].Nazwa;
      if(!firstModelName) {
        log("Brak nazwy modelu w pierwszym wierszu arkusza");
        return;
      }
      const modelPath = `chairs/${firstModelName}.glb`;
      log(`Ładowanie modelu: ${modelPath}`);

      loader.load(
        modelPath,
        (gltf) => {
          log(`Model ${firstModelName} załadowany pomyślnie.`);
          scene.add(gltf.scene);
          animate();
        },
        (xhr) => {
          if (xhr.lengthComputable) {
            const percent = (xhr.loaded / xhr.total) * 100;
            log(`Ładowanie modelu: ${percent.toFixed(2)}%`);
          }
        },
        (error) => {
          log(`Błąd ładowania modelu: ${error.message || error}`);
        }
      );

    } else {
      log("Nieoczekiwany format danych z arkusza - brak klucza 'Nazwa'");
      log("Pierwszy element danych: " + JSON.stringify(data[0]));
    }
  })
  .catch(err => {
    log("Błąd pobierania arkusza: " + err);
  });

function animate() {
  requestAnimationFrame(animate);
  renderer.render(scene, camera);
}

window.addEventListener('resize', () => {
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
